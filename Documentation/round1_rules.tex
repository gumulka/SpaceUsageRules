\section{Regeln}

\subsection{Formale Beschreibung:}
Sei $ID$ die die Bezeichnung eines Bildes.\\
Sei $t$ ein Tag $(key \to value)$ aus OpenStreetMap.\\
Sei $r(t)$ eine Regel $t \to [0..2]$ \\
Sei $Z_{X}$ die Menge der Tag $t$ für die Gilt: $t$ kommt in X vor. \\
Sei $R_v$ eine Menge von Funktionen $r$ für das Verbot $v$\\
Sei $C_{ID}$ die Geocoordinate, an welcher das Bild zu $ID$ aufgenommen wurde. \\
Sei $D_{X,ID}$ der Abstand eines Polygons $X$ zu $C_{ID}$ \\
Sei $O_{ID}$ eine Menge von Polygonen aus OpenStreetMap in der Umgebung zu $C_{ID}$\\
Sei $A_{X}$ die Fläche des Polygons $X$\\
Sei $V$ die Menge aller Verbote $v$.\\
Sei $V_{ID}$ die Menge der Verbote für die gilt: $v$ wird auf dem Bild zu $ID$ abgebildet.\\
Sei $S_{v}$ die Menge der $ID$ für die gilt: $v \in V_{ID}$\\
Sei $P_{ID}$ das gegebene Lösungspolygon zu $ID$.\\
Sei $I(X,Y)$ das Schnittpolygon der Polygone X und Y\\
\\
Sollte es für ein $t$ kein $r(t)$ geben, so wird die standartregel:
$r(t) = 1$ angewendet.

\begin{equation}
Gew(R,ID,X) := \sum_{v \in V_{ID}} \Big((1 + D_{X,ID})\prod_{t \in Z_X} \prod_{r \in R_v} r(t)\Big)
\end{equation}

\begin{align}
G(ID,R) := \{X \in O_{ID} | & Gew(R,ID,X) < Gew(R,ID,Y)\\
& \lor \Big(Gew(R,ID,X)=Gew(R,ID,Y) \land A_X < A_Y\Big) \forall Y\} \notag
\end{align}

\subsection{Beispiel}
Eine Regel kann z.B. so aussehen:
Für das Verbot Nichtrauchen: wenn ein Tag den Key 'building' enhält dann halbiere den Abstand. \\
$R_{nichtrauchen} = [r('building') = 0.5]$\\
\newline
Seien in der Umgebung zu $ID$ nur zwei Flächen A,B in OpenStreetMap vorhanden.
\begin{itemize}
\item A enthält die Tags: 'building -> yes', 'addr:housenumber -> 34' und hat den Abstand 0.002;
\item B enthält die Tags: 'landuse->residential' und hat den Abstand 0;
\end{itemize}
Daraus errechnet sich:
\begin{itemize}
\item $Gew(R,ID,A) = (1+0.002) * 0.5 * 1 = 0.501$
\item $Gew(R,ID,B) = (1+0.0) * 1 = 1$
\end{itemize}

$G(ID,R) = A$

\subsection{Maschinelle Überprüfung der Regelsätze}
Um die Güte der verschiedenen Regeln zu überprüfen wird ein Programm geschrieben, welche für jede Regel die die Schnittpolygone von unseren Polygonen mit
den Musterlösungen bildet und anschließen durch je die Fläche unseres Polygons, sowie des Musterlösungspolygons teilt.
Von beiden Zahlen wird das Minimun genommen und als Indicator der Lösungsgüte angesehen.\\
\begin{equation}
f(v,R) := \sum_{q\in S_v} min(\frac{I(P_q,G(q,R))}{P_q},\frac{I(P_q,G(q,R))}{G(q,R)})
\end{equation}
Um die Güte des Regelsatzes für ein einzelnes Verbot vergleichbar zu anderen Verboten zu machen wird abschließend der Indicator durch
die Anzahl der $ID$s welches es beeinflussen geteilt.\\
\begin{equation}
\label{eq:guete}
Güte(R) := \sum_{v \in V} \frac{ f(v,R)}{\#S_v}
\end{equation}

Wir suchen also einen Regelsatz $R$ für den $Güte(R)$ maximal ist.


\subsection{Visuelle Überprüfung}
\label{sec:visuelle_ueberpruefung}
Um die KML-Dateien nicht immer manuell in Google-Earth laden zu müssen, wurde eine weitere Klasse geschrieben, welche zur Visualisierung der Daten gedacht ist.
Dabei werden Bilder erstellt, in welchen die Daten aus OSM als schwarze Linien, bzw Polygone eingezeichnet werden. Zusätzlich werden die Tags, 
welche die Objekte enthalten zu jedem Objekt eingezeichnet um schnell eine Übersicht zu haben, was wozu gehört.
Um die Güte des Regeldatensatzes, bzw des Algorithmus subjektiv beurteilen zu können, werden die truth, bzw. die von unserem Algorithmus erdachten Polygone
farblich eingezeichnet. so ist eine schnelle Beurteilung, ob man das richtige Poylgon gewählt hat, bzw welche Tags man evtl noch beachten sollten möglich.

\subsection{Incrementelle Regelerstellung}
Aus dem Testdatensatz werden zunächst alle Datensätze herausgefiltert, welche nicht einfach lösbar sind.
Es wird mit einem leeren Regelsatz angefangen und dieser anschließend inkrementel erweitert. Dazu wird wie Folgt vorgegangen:
\begin{enumerate}
\item Definiere für jeden Datensatz ein optimales Polygon, bzw einen Overlap-Wert, welcher erreicht werden muss.
\item Der Regelsatz wird auf alle Testdatensätze angewendet.
\item Für jeden Datensatz, bei welchem die Regeln nicht das optimale Polygon finden, wird ein Bild wie in \fref{sec:visuelle_ueberpruefung} erstellt.
\item Dem Benutzer werden alle Bilder, angezeigt und dieser kann nun weitere Regeln hinzufügen oder bestehende ändern.
\item gehe zu 2
\end{enumerate}
Nachdem alle einfachen Fälle abgedeckt sind, kann nun mit den schwierigeren Vorgegangen werden.
Gehe dazu erneut so vor.

\subsection{Mögliche Erweiterung}
Um den Fall abzudecken, in welchem in OpenStreetMap keine ausreichenden Daten vorhanden sind, wird um den Punkt $C_{ID}$ ein
Achteck\footnote{Relativ geringer Rechenaufwand bei gleichzeitig bester Annäherung an einen Kreis.} mit Radius $b$ gelegt
und dieses mit der gewichtet nächsten Großfläche geschnitten.
Eine Großfläche X definiert sich dadurch, dass ihre Fläche $A_X$ einen schwellwert $u$ überschreitet.
Es ist zu prüfen ob es sinnvoll ist dieses generell zu tun oder für bestimmte Regel ausser kraft zu setzen wie
z.B. ein Verbot nach offenem Feuer, welches in einem ganzen Parkgebiet gelten wird.